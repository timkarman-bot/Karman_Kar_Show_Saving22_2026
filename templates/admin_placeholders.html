{% extends "base.html" %}
{% set title = "Placeholder Cars • Admin" %}

{% block content %}
<div class="max-w-5xl">
  <div class="flex items-end justify-between gap-4">
    <div>
      <div class="text-xs font-semibold text-slate-500">RESTRICTED</div>
      <h1 class="mt-1 text-3xl font-semibold tracking-tight">Placeholder cars</h1>
      <p class="mt-2 text-slate-600">
        Pre-generate car numbers with unique tokens so windshield cards can be printed ahead of time.
      </p>
    </div>
    <a class="btn btn-outline" href="{{ url_for('admin_page') }}">Back to admin</a>
  </div>

  <div class="mt-6 rounded-3xl bg-white border border-slate-200 shadow-sm p-6">
    <div class="text-xs font-semibold text-slate-500">CREATE PLACEHOLDERS</div>
    <form method="POST" action="{{ url_for('admin_placeholders_create') }}" class="mt-4 grid gap-4 md:grid-cols-3">
      <div>
        <label class="text-sm font-semibold">Start car #</label>
        <input name="start_number" value="1" class="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-3">
      </div>
      <div>
        <label class="text-sm font-semibold">Count</label>
        <input name="count" value="50" class="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-3">
      </div>
      <div class="flex items-end">
        <button class="btn btn-primary" type="submit">Create</button>
      </div>
    </form>
  </div>

  <div class="mt-6 rounded-3xl bg-white border border-slate-200 shadow-sm p-6">
    <div class="text-xs font-semibold text-slate-500">CURRENT CARS</div>
    <div class="mt-4 overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="text-xs uppercase text-slate-500">
          <tr>
            <th class="text-left py-2">Car #</th>
            <th class="text-left py-2">Owner</th>
            <th class="text-left py-2">Vehicle</th>
            <th class="text-left py-2">Cards</th>
            <th class="text-left py-2">Check-in</th>
            <th class="text-left py-2">Waiver</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for c in cars %}
            <tr>
              <td class="py-3 font-semibold">#{{ c["car_number"] }}</td>
              <td class="py-3">{{ c["owner_name"] or "—" }}</td>
              <td class="py-3">{{ c["year"] }} {{ c["make"] }} {{ c["model"] }}</td>
              <td class="py-3">
                <a class="px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50"
                   href="{{ url_for('registration_complete', show_slug=show['slug'], car_token=c['car_token']) }}">
                  Print
                </a>
              </td>
              <td class="py-3">
                <a class="px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50"
                   href="{{ url_for('checkin_page', show_slug=show['slug'], car_token=c['car_token']) }}">
                  Owner check-in
                </a>
              </td>
              <td class="py-3">
                <div class="flex items-center gap-2 flex-wrap">
                  {% if c["waiver_received"] == 1 %}
                    <span class="px-3 py-1 rounded-full bg-emerald-50 text-emerald-800 border border-emerald-200 text-xs font-semibold">
                      Received
                    </span>
                  {% else %}
                    <span class="px-3 py-1 rounded-full bg-slate-50 text-slate-700 border border-slate-200 text-xs font-semibold">
                      Not yet
                    </span>
                    <form method="POST" action="{{ url_for('admin_waiver_received') }}">
                      <input type="hidden" name="show_car_id" value="{{ c['id'] }}">
                      <button class="px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50" type="submit">
                        Mark received
                      </button>
                    </form>
                  {% endif %}

                  <a class="px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50"
                     href="{{ url_for('waiver_print', show_slug=show['slug'], car_token=c['car_token']) }}">
                    Print waiver
                  </a>
                </div>
              </td>
            </tr>
          {% endfor %}
          {% if not cars %}
            <tr><td class="py-5 text-slate-500" colspan="6">No cars yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
