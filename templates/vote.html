{% extends "base.html" %}
{% block content %}

<div class="vote-header">
  <img src="/static/KarmanKarShowsLogo.png" alt="Karman Kar Shows & Events Logo" class="vote-logo">
  <div>
    <h1>Vote for Car {{ car_id }}</h1>
    <p class="vote-subtitle">Karman Kar Shows & Events</p>
  </div>
</div>

<div class="vote-rules">
  <h2>How Voting Works</h2>
  <ul>
    <li><strong>Branch Awards (Veterans Only):</strong> Veterans vote for the branch they served (Army, Navy, Air Force, Marines, Coast Guard, Space Force).</li>
    <li><strong>People’s Choice (Open to All):</strong> Anyone can vote in People’s Choice.</li>
    <li><strong>$1 per vote:</strong> Vote as many times as you want. Each vote is <strong>$1</strong>.</li>
    <li><strong>One win per category:</strong> A car can only win once in each category.</li>
  </ul>
</div>

{% if error %}
  <div class="alert"><strong>{{ error }}</strong></div>
{% endif %}

<form method="POST" action="/create-checkout-session" class="vote-form">
  <input type="hidden" name="car_id" value="{{ car_id }}">
  <input type="hidden" name="amount" value="1">

  <label for="branch">Select Category</label>
  <select name="branch" id="branch" required>
    {% for branch in branches %}
      <option value="{{ branch }}">{{ branch }}</option>
    {% endfor %}
  </select>

  <!-- VETERAN CHECKBOXES (required for branch categories, not required for People’s Choice) -->
  <div id="veteranBoxes" class="checkbox-block">
    <label class="checkbox-row">
      <input type="checkbox" id="is_veteran" name="is_veteran" value="yes">
      <span>I am a veteran.</span>
    </label>

    <label class="checkbox-row">
      <input type="checkbox" id="served_branch_confirm" name="served_branch_confirm" value="yes">
      <span>I confirm I served in the selected branch.</span>
    </label>

    <p class="vote-note">
      People’s Choice is open to all. Branch voting is for veterans voting within the branch they served.
    </p>
  </div>

  <label for="quantity">Number of Votes ($1 each)</label>
  <input type="number" id="quantity" name="quantity" min="1" max="50" value="1" required>

  <button type="submit">Vote Securely with Stripe</button>

  <p class="smallprint">
    You’ll be redirected to Stripe Checkout to complete payment.
  </p>
</form>

<script>
  // Hide/disable veteran checkboxes if People’s Choice is selected
  (function () {
    const peopleChoiceLabel = "People’s Choice";
    const branchSelect = document.getElementById("branch");
    const boxes = document.getElementById("veteranBoxes");
    const isVet = document.getElementById("is_veteran");
    const servedConfirm = document.getElementById("served_branch_confirm");

    function updateBoxes() {
      const isPeopleChoice = branchSelect.value === peopleChoiceLabel;

      boxes.style.display = isPeopleChoice ? "none" : "block";

      // For branch categories, require both checkboxes
      isVet.required = !isPeopleChoice;
      servedConfirm.required = !isPeopleChoice;

      // If People’s Choice, clear checks so nothing is accidentally submitted
      if (isPeopleChoice) {
        isVet.checked = false;
        servedConfirm.checked = false;
      }
    }

    branchSelect.addEventListener("change", updateBoxes);
    updateBoxes();
  })();
</script>

{% endblock %}
