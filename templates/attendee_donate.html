{% extends "base.html" %}
{% set title = "Optional Donation • " ~ show["title"] %}

{% block content %}
<div class="max-w-2xl">
  <div class="rounded-3xl bg-white border border-slate-200 shadow-sm p-8">
    <div class="text-xs font-semibold text-slate-500">OPTIONAL</div>
    <h1 class="mt-1 text-3xl font-semibold tracking-tight">Support today’s cause</h1>
    <p class="mt-3 text-slate-600">
      Donations are appreciated but not required to attend.
    </p>

    <div class="mt-6 grid gap-3">
      <button class="btn btn-outline" onclick="donate(5)">$5</button>
      <button class="btn btn-outline" onclick="donate(10)">$10</button>
      <button class="btn btn-outline" onclick="donate(20)">$20</button>
      <button class="btn btn-outline" onclick="donateCustom()">Other amount</button>

      <button class="btn btn-primary" onclick="donate(0)">No thanks / $0 today</button>
    </div>

    <div id="err" class="mt-4 text-sm text-red-700 hidden"></div>
  </div>
</div>

<script>
  async function donate(amount) {
    const err = document.getElementById("err");
    err.classList.add("hidden");
    err.textContent = "";

    try {
      const form = new FormData();
      form.append("show_slug", "{{ show['slug'] }}");
      form.append("attendee_id", "{{ attendee_id }}");
      form.append("amount_dollars", String(amount));

      const res = await fetch("/attend/create-donation-checkout", { method: "POST", body: form });
      const data = await res.json();

      if (!data.ok) {
        err.textContent = data.error || "Network error. Please try again.";
        err.classList.remove("hidden");
        return;
      }
      if (data.skipped) {
        window.location.href = data.redirect_url;
        return;
      }
      window.location.href = data.checkout_url;
    } catch (e) {
      err.textContent = "Network error. Please try again.";
      err.classList.remove("hidden");
    }
  }

  function donateCustom() {
    const v = prompt("Enter donation amount in dollars (example: 15):");
    if (!v) return;
    const n = Number(v);
    if (!isFinite(n) || n <= 0) return;
    donate(n);
  }
</script>
{% endblock %}
