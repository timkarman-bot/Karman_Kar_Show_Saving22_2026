{% extends "base.html" %}
{% block content %}

<h1>Admin Dashboard</h1>

<hr>

<h2>Voting Controls</h2>

<form method="POST" action="/admin/set-end-time">
    <label>Set Voting End Date & Time</label><br>
    <input type="datetime-local" name="end_time">
    <br>
    <button type="submit">Set End Time</button>
</form>
<br>

<h3>Max Cars</h3>
<form method="POST" action="/admin/set-max-cars">
  <label>Set Maximum Number of Cars</label><br>
  <input type="number" name="max_cars" min="1" max="2000" value="{{ max_cars }}" required>
  <button type="submit">Update Max Cars</button>
</form>

<br>

<form method="POST" action="/admin/lock">
    <button class="danger">Lock Voting Now</button>
</form>

<form method="POST" action="/admin/unlock">
    <button class="success">Unlock Voting</button>
</form>
<a href="/admin-logout">Logout</a>
<hr>

<div class="mt-4 flex flex-wrap gap-3">
  <form method="POST" action="/admin/reset-votes" onsubmit="return confirm('Reset ALL votes? This cannot be undone.');">
    <button class="px-4 py-2 rounded-xl border border-red-200 text-red-700 hover:bg-red-50" type="submit">
      Reset votes
    </button>
  </form>

  <a class="px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50" href="/admin/export-votes.csv">
    Export votes CSV
  </a>

  <a class="px-4 py-2 rounded-xl border border-slate-200 hover:bg-slate-50" href="/admin/cars">
    Manage cars
  </a>
</div>

<h2>Live Vote Totals</h2>

<table>
    <tr>
        <th>Car</th>
        <th>Branch</th>
        <th>Total Votes</th>
        <th>Total Raised</th>
    </tr>

    {% for row in totals %}
    <tr>
        <td>{{ row[0] }}</td>
        <td>{{ row[1] }}</td>
        <td>{{ row[2] }}</td>
        <td>${{ row[3] }}</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
