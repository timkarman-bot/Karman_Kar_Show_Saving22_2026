{% extends "base.html" %}
{% set title = "Current Show • Karman Kar Shows & Events" %}

{% block content %}
{% if not_found %}
  <div class="rounded-3xl bg-white border border-slate-200 p-8 shadow-sm">
    <h1 class="text-2xl font-semibold">Show not found</h1>
    <p class="mt-2 text-slate-600">That event isn’t available.</p>
    <a class="inline-block mt-5 btn btn-primary" href="{{ url_for('home') }}">Go home</a>
  </div>
{% else %}

  {% if title_sponsor %}
  <section class="rounded-3xl bg-white border border-slate-200 shadow-sm p-6">
    <div class="text-xs font-semibold text-slate-500">TITLE SPONSOR</div>
    <div class="mt-2 rounded-2xl border border-slate-200 bg-slate-50 p-4 flex items-center gap-4">
      {% if title_sponsor["logo_path"] %}
        <img class="h-12 w-auto" src="{{ url_for('static', filename=title_sponsor['logo_path']) }}" alt="{{ title_sponsor['name'] }}">
      {% else %}
        <div class="h-12 w-28 rounded-xl border border-dashed border-slate-300 grid place-items-center text-xs text-slate-500">Logo</div>
      {% endif %}
      <div class="min-w-0">
        <div class="font-semibold">{{ title_sponsor["name"] }}</div>
        {% if title_sponsor["website_url"] %}
          <div class="text-sm text-slate-600 truncate">{{ title_sponsor["website_url"] }}</div>
        {% endif %}
      </div>
    </div>
  </section>
  {% endif %}

  <section class="mt-6 rounded-3xl p-8 glass border border-slate-200 shadow-sm">
    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">
      <div>
        <h1 class="text-4xl font-semibold tracking-tight">{{ show["title"] }}</h1>
        <p class="mt-3 text-slate-700 max-w-2xl">{{ show["description"] }}</p>

        <div class="mt-6 grid gap-2 text-sm text-slate-700">
          {% if show["date"] %}<div><span class="font-semibold">Date:</span> {{ show["date"] }}</div>{% endif %}
          {% if show["time"] %}<div><span class="font-semibold">Time:</span> {{ show["time"] }}</div>{% endif %}
          {% if show["location_name"] %}<div><span class="font-semibold">Location:</span> {{ show["location_name"] }}</div>{% endif %}
          {% if show["address"] %}<div><span class="font-semibold">Address:</span> {{ show["address"] }}</div>{% endif %}
          {% if show["benefiting"] %}<div><span class="font-semibold">Benefiting:</span> {{ show["benefiting"] }}</div>{% endif %}
          {% if show["suggested_donation"] %}<div><span class="font-semibold">Suggested donation:</span> {{ show["suggested_donation"] }}</div>{% endif %}
        </div>

        <div class="mt-7 flex flex-wrap gap-3">
          {% if prereg_allowed(show) %}
            <a class="btn btn-primary" href="{{ url_for('register_page') }}">Register your car</a>
          {% else %}
            <div class="px-4 py-2 rounded-2xl border border-slate-200 bg-slate-50 text-slate-700">
              No pre-registration for this show — register on-site via QR check-in.
            </div>
          {% endif %}
          <a class="btn btn-outline" href="{{ url_for('events') }}">Upcoming events</a>
        </div>

        <div class="mt-5 text-xs text-slate-500">
          Voting is via QR codes displayed on each car.
        </div>
      </div>

      <div class="rounded-3xl bg-white border border-slate-200 p-6 shadow-sm w-full lg:w-96">
        <div class="text-xs font-semibold text-slate-500">VOTING STATUS</div>
        <div class="mt-1 text-2xl font-semibold">
          {% if show["voting_open"] == 1 %}Open{% else %}Closed{% endif %}
        </div>
        <p class="mt-2 text-sm text-slate-600">
          If voting is closed, the vote pages will show a “Voting Closed” message.
        </p>
      </div>
    </div>
  </section>

  <section class="mt-8 rounded-3xl bg-white border border-slate-200 shadow-sm p-6">
    <div class="flex items-end justify-between gap-4">
      <div>
        <div class="text-xs font-semibold text-slate-500">REGISTERED CARS</div>
        <h2 class="mt-1 text-2xl font-semibold">Car list</h2>
        <p class="mt-2 text-sm text-slate-600">
          Owner name and car info are public. Phone & email are never shown publicly.
        </p>
      </div>
    </div>

    <div class="mt-5 overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="text-xs uppercase text-slate-500">
          <tr>
            <th class="text-left py-2">Car #</th>
            <th class="text-left py-2">Owner</th>
            <th class="text-left py-2">Vehicle</th>
            <th class="text-left py-2">Cards</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for c in cars %}
            <tr>
              <td class="py-3 font-semibold">#{{ c["car_number"] }}</td>
              <td class="py-3">{{ c["owner_name"] or "—" }}</td>
              <td class="py-3">{{ c["year"] }} {{ c["make"] }} {{ c["model"] }}</td>
              <td class="py-3">
                <a class="px-3 py-2 rounded-xl border border-slate-200 hover:bg-slate-50"
                   href="{{ url_for('registration_complete', show_slug=show['slug'], car_token=c['car_token']) }}">
                  View/Print
                </a>
              </td>
            </tr>
          {% endfor %}
          {% if not cars %}
            <tr><td class="py-5 text-slate-500" colspan="4">No cars registered yet.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>

{% endif %}
{% endblock %}
